// ----------------------
// Manager Service IDL
// ----------------------

// ---- Const definitions ----

const int    MAX_AGE = 150 // years
const int    MIN_AGE = 18
const bool   DEFAULT_VIP = false
const string DEFAULT_ROLE = "user"
const int    DEFAULT_PAGE = 1
const int    DEFAULT_PAGE_SIZE = 20
const int    MAX_PAGE_SIZE = 100
const float  SALARY_MIN = 0.0
const float  SALARY_MAX = 1000000.0

// ---- Enum definitions ----

// Standard error codes
enum ErrCode {
    ERR_OK = 0
    PARAM_ERROR = 1003 ( errmsg="param error" )
    NOT_FOUND = 4004
    PERMISSION_DENIED = 4003
    INTERNAL_ERROR = 5000
}

// Manager seniority levels
enum ManagerLevel {
    JUNIOR = 1
    MIDDLE = 2
    SENIOR = 3
}

// Company departments
enum Department {
    ENGINEERING = 1
    MARKETING = 2
    SALES = 3
    HR = 4
    FINANCE = 5
}

// ---- Core types ----

// Generic response wrapper for all RPCs
type Response<T> {
    required ErrCode errno (validate="OneOfErrCode($)")
    required string errmsg
    T data
}

// Pagination request and response
type PageReq {
    required int page (json="page", validate="$ >= 1", query="page")
    required int size (validate="$ >= 1 && $ <= MAX_PAGE_SIZE", query="size")
}

type PageResp<T> {
    int total
    int page
    int size
    list<T> items
}

// Address & Contact info
type Address {
    string city
    string street (go.type="*string")
    string postalCode
}

type ContactInfo {
    required string email (validate="Email($)")
    string phone
    Address address
}

// Department info
type DepartmentInfo {
    Department dept
    string deptName
}

// ---- Manager domain ----

// Manager entity definition
type Manager {
    string id
    string name (validate="len($) > 0 && len($) <= 64")
    int age (validate="$ >= MIN_AGE && $ <= MAX_AGE")
    bool vip
    float salary (validate="$ >= SALARY_MIN && $ <= SALARY_MAX")
    string role
    ManagerLevel level (enum_as_string)
    DepartmentInfo deptInfo
    ContactInfo contact
    list<ContactInfo> contactInfos
    list<list<ContactInfo>> contactInfoV2s
    list<list<list<ContactInfo>>> contactInfoV3s
    map<string,ContactInfo> contactMaps
    map<string,list<ContactInfo>> contactMapV2s
    map<string,map<int,ContactInfo>> contactMapV3s
    map<string,string> extra
    map<string,map<string,string>> extraV2
    map<string,map<string,map<string,string>>> extraV3
    map<string,map<string,list<string>>> extraV4
    map<string,list<string>> extraV5
}

// ---- Request types ----

// Single manager by ID
type ManagerReq {
    string id (path="id")
}

// Create new manager
type CreateManagerReq {
    string name (validate="len($) > 0 && len($) <= 64")
    int age (validate="$ >= MIN_AGE && $ <= MAX_AGE")
    bool vip
    float salary (validate="$ >= SALARY_MIN && $ <= SALARY_MAX")
    string role
    ManagerLevel level (enum_as_string)
    DepartmentInfo deptInfo
    ContactInfo contact
}

// Update existing manager
type UpdateManagerReq {
    string ID (json="id", path="id")
    string name
    int age (validate="$ >= MIN_AGE && $ <= MAX_AGE")
    bool vip (json=",non-omitempty")
    float salary (validate="$ >= SALARY_MIN && $ <= SALARY_MAX")
    string role
    ManagerLevel level
    DepartmentInfo dept_info
    ContactInfo contact
}

// Paginated manager query
type ListManagersByPageReq {
    PageReq
    list<string> keyword (
        query="keyword"
        validate="len($)<=5"
    )
    Department dept (query="dept")
    ManagerLevel minLevel (query="minLevel")
    bool vip (query="vip")
}

// ---- Response types ----

// Create / Update / Get responses
type CreateManagerResp Response<Manager>
type UpdateManagerResp Response<Manager>
type GetManagerResp Response<Manager>
type DeleteManagerResp Response<bool>

// Paginated response
type ManagersPageData PageResp<Manager>
type ListManagersByPageResp Response<ManagersPageData>

// ---- RPC definitions ----

// Create a new manager
rpc CreateManager(CreateManagerReq) CreateManagerResp {
    method="POST"
    path="/managers"
    contentType="json"
    summary="Create a new manager"

    // timeouts
    connTimeout=100
    readTimeout=100
    writeTimeout=100
}

// Get manager by ID
rpc GetManager(ManagerReq) GetManagerResp {
    method="GET"
    path="/managers/{id}"
    contentType="form"
    summary="Get manager by ID"

    // timeouts
    connTimeout=100
    readTimeout=100
    writeTimeout=100
}

// Update manager info
rpc UpdateManager(UpdateManagerReq) UpdateManagerResp {
    method="PUT"
    path="/managers/{id}"
    contentType="json"
    summary="Update a manager"

    // timeouts
    connTimeout=100
    readTimeout=100
    writeTimeout=100

    // response type
    resp.go.type="map[string]any"
}

// Delete a manager
rpc DeleteManager(ManagerReq) DeleteManagerResp {
    method="DELETE"
    path="/managers/{id}"
    contentType="form"
    summary="Delete a manager"

    // timeouts
    connTimeout=100
    readTimeout=100
    writeTimeout=100
}

// List managers with pagination
rpc ListManagersByPage(ListManagersByPageReq) ListManagersByPageResp {
    method="GET"
    path="/managers/page"
    contentType="form"
    summary="List managers with pagination"

    // timeouts
    connTimeout=100
    readTimeout=100
    writeTimeout=100
}
